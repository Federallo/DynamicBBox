% setting document languate
\documentclass[italian]{article}

% setting italian font encoding
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{babel}

\begin{document}
\section*{Introduzione}
%Inserire introduzione
\section*{Tecnlogie utilizzate}
Nella seguente sezione saranno elencate le tecnologie utilizzate per lo sviluppo del progetto. Alcune di esse, essendo state utilizzate principalmente dal mio collega, Marco Bardazzi, verranno passate in rassegna più rapidamente.\\
Ciascuna di esse, comunque, è stata implementata in Python.
\subsection{LiDAR}
LiDAR, o Light Detection and Ranging, rappresenta uno strumeto di telerilevamento che determina la distanza di un oggetto o superfice, utilizzando impulsi laser che li vanno a colpire.\\
Il risultato di tale processo è una pointcloud.
\subsection{Datasets}
Affinché si avesse una generazione affidabile delle pointcloud a partire dai dataset, è stato necessario l'utilizzo di \textit{Arogverse} per l'acquisizione di scenari e modelli, e \textit{Blensor} per simulare scansioni LiDAR.\\
\subsubsection{Argoverse}
Argoverse è un dataset open-source, sviluppato dall'Università Carnegie Mellon e dal Georgia Institute of Tecnology negli Stati Uniti. Le mappe disponibili includono metadati, utili per lo sviluppo di sistemi a guida autonoma.\\
I dati sono stati raccolti in Miami e Pittsburgh, due città caratterizzate da due comportamenti di guida differenti. Nel progetto è stato analizzata la mappa di un incrocio di Pittsburgh, incluso uno storico dei veicoli passanti (specificando per ciascuno ID, posizioni e velocità).\\
Nonostante tali dati siano stati raccolti attraverso veicoli con telecamere e sensori LiDAR, questi ultimi non influenzano assolutamente il progetto.
\subsubsection{BlenSor}
BlenSor è un package dell'applicazione Blender che permette di simulare scansioni LiDAR. Sviluppata dall'Università di Salisburgo, ha come principale vantaggio quello di creare scenari che, nel caso della guida autonoma, nella realtà non sarebbero possibili o sarebbe troppo costoso riprodurli (come per esempio una sitazione di incidente).\\
Nel nostro caso è risultato cruciale sfruttare algoritmi di norma presenti in sensori, senza possederli fisicamente.\\
La simulazione tramite Blensor genera un file .csv per ogni istante simultato e contenente le coordinate dei punti della pointcloud (senza rumore e filtrati).%TODO aggiungere nota: per filtrati si intende che non sono presenti i punti che rappresentano il terreno.
\subsection{Open3D}
Open3D è una libreria open-source che dispone di funzionalità grafiche per programmi Python e C++. Le principali features sono la possibilità di creare strutture dati 3D, la presenza di algoritmi di data processing in 3D utilizzabili e l'accelerazione hardware per operazioni 3D più laboriose.\\
Per lo sviluppo del progetto è stata sfruttata per la clusterizzazione delle pointcloud e per la visualizzazione grafica.
\subsubsection{Pointcloud}
La pointcloud è una struttura dati che rappresenta un insieme di punti nello spazio 3D. Viene istanziata tramite \textit{geometry.PointCloud()} e i punti di coordinate (x,y,z) vengono aggiunti come \textit{utlityVector3dVector(list)}\\
\subsubsection*{Sottocampionamento}
Essendo il campionamento delle pointcloud tramite scansioni LiDAR molto elevato, è stato necessario sottocampionare le pointcloud per ridurre il numero di punti e velocizzare l'elaborazione. Attraverso \textit{pointcloud.voxeldownsample(size)}  viene sottocampionata la pointcloud a partire da cubi di lato \textit{size}. Questi ultimi dividono lo spazio 3D in griglie e per ciascuna griglia viene mantenuto un solo punto.
\subsubsection*{Clustering}
Open3D dispone di un algoritmo di clustering, \textit{pointcloud.cluster\_dbscan(eps, min\_points, print\_progress)}, che permette di clusterizzare i punti della pointcloud.\\
E' un metodo di raggruppamento di punti a una distanza e con un numero di punti minimo prestabiliti.\\
Ovviamente questo metodo viene sfruttato solo in due situazioni nel seguente progetto: per la prima creazione delle bounding box e per la clusterizzazione di punti esterni alle bounding box.
\subsubsection{Bounding Box}
Le Bounding box sono rettangoli (o parallelepipedi in 3D) che racchiude un insieme di punti della pointcloud.\\
Esistono tre categorie di bounding box:
\begin{itemize}
	\item Axis-Aligned Bounding Box (AABB): rappresenta una bounding box allineata con gli assi cartesiani. Dei tre è il più veloce da calcolare, ma può ricoprire più area del normale.
	\item Obriented Bounding Box (OBB): è una bounding box orientata in base alla forma della pointcloud. E' più accurata dell'AABB, ma richiede più tempo per essere calcolata.
	\item Minimum Bounding Box (MBB): individua la bounding box con la minima area che racchiude l'insieme di punti della pointcloud. Soprattutto in dimensioni superiori a due, richiede molto tempo per essere calcolata.
\end{itemize}
Allo scopo del progetto, è stata utilizzata la bounding box di tipo OBB, in quanto la più accurata per il nostro scopo.
Open3D offre la possibilità di creare le bounding box a partire dalla pointcloud utilizzando il metodo \textit{pointcloud.get\_oriented\_bounding\_box)}, il quale ritorna un oggetto \textit{geometry.OrientedBoundingBox}.\\
Inoltre, Open3D permette di assegnare un colore alle bounding box, utilizzando il metodo \textit{obb.color = [r,g,b]}.
\subsubsection*{Punti interni alla bounding box}
Lo scopo del progetto è quello di aggiornare le bounding box nel modo più rapido possibile. La funzione \textit{OrientedBoundingBox.get\_point\_indices\_within\_bounding\_box(pointcloud.points)} è cruciale per individuare i core points della pointcloud, da cui poi crearne il nuovo cluster e aggiornare la bounding box. Essenzialmente, analizza ogni singolo punto dato come argomento (in questo caso pointcloud.points) e ritorna un array di booleani, dove il valore true indica che il punto è interno alla bounding box. Un punto viene considerato tale se, proiettando il singolo punto sui tre assi, risulta compreso tra i valori minimi e massimi di ciascun asse, i quali sono definiti dall'attributo \textit{extent} della OBB.
Questo metodo è ottimizzato per pointcloud di grandi dimensioni e garantisce un'ottima accuratezza nell'individuare i punti.


Il seguente progetto consiste nell'aggiornare i bounding box generati inizialmente dall'algoritmo della repository blensor\_analysis.\\
Per poter inizializzare il cluster all'interno della bounding box, è stato utilizzato un algoritmo di DBSCAN custom, il quale prende come argomenti la bounding box dello scan corrente e la point cloud dello scan successivo.\\
Una volta determinati i punti interni alla bounding box, seleziona il cluster con più punti al suo interno, il quale rappresenta l'oggetto associato alla bounding box, e ne crea un nuovo bounding box.\\
In caso ci fossero dei punti esterni dalle bounding box, questi vengono analizzati dall'algoritmo della repository blensor\_analysis e, in caso venissero indivduate nuove bounding box, vengono aggiunte alla lista di bounding box da aggiornare.\\
\section{Descrizione dei file}
Nella seguente sezione vengono trattate nel dettaglio i singoli file del progetto.
\subsection{pointcloud}
Il seguente file contiene un solo metodo, generatePointCloud, il quale permette di generare la point cloud senza noise e filtrate a partire dal file .csv.\\
\subsection{blensoranalysis}
Il file blensoranalysis presenta metodi che servono da tramite tra DynamicBBox e la repository blensor\_analysis.
\begin{itemize}
		\item generateBoundingBox: il seguente metodo viene utilizzato per generare le bounding boxes al primo avvio del programma e vengono mostrate in output tramite liberia open3d. Come argomenti prende
			l'indice dello scan e il numero di sensori che eseguono lo scan. 
 		\item generateBB: genera le bounding box tramite pointcloud data in input e vengono aggiunte, in un momento successivo, alla lista di bounding box aggiornate.
\end{itemize}
\subsection{customdbscan}
In customdbscan viene preso l'algoritmo di DBSCAN e viene adattato allo scopo del progetto.\\
Sono stati implementati due modi diversi:
\subsubsection{Espansione della bounding box}
Impelementato nel file dbscan\_expand\_bbox, le bounding box vengono prima espanse e successivamente vengono clusterizzati i punti al loro interno.
I metodi implementati sono:
\begin{itemize}
	\item customDBSCAN: il metodo customDBSCAN prende come argomenti le point clouds dello scan successivo, la bounding box, il fattore di espansione delle bounding boxes, eps (distanza massima tra due punti per essere considerati nello stesso cluster) e minPts (numero minimo di punti per formare un cluster).\\ Inizialmente individua i punti interno alla bounding box. Successivamente li clusterizza assegnandogli un label.
	\item expandCluster: rappresenta il metodo che esegue la ricerca dei punti a distanza eps ddai neighbours e li aggiunge al cluster.
	\item expand\_bounding\_: è la funzione che espande effettivamente la bounding box data in input.
	\item pointsInBB: individua i punti interni alla bounding box.
	\item createBoundingBoxes: è la funzione che crea la bounding box dati i labels dei punti interni alla bounding box. Essenzialmente rimuove tutti quei label che individuano cluster più piccoli e crea la bounding box relativa al cluster più grande.
\end{itemize}
\subsubsection{Clusterizzazione dei punti vicini alla bounding box}
Implementato in dbscan\_near\_search, rispetto al metodo precedente non viene espansa la bounding box, ma nei metodi customDBSCAN e expandCluster vengono considerati anche i punti esterni alla bounding box. Quelli che sono vicini vengono aggiunti all lista dei points e dei labels.
\subsection{bbtracking}
Il seguente file presenta i seguenti metodi:
\begin{itemize}
	\item updateBB: il metodo updateBB aggiorna le buonding boxes date in input considerando le point clouds dello scan successivo usando customDBSCAN. Prima che venga invocato quest'ultimo, viene mostrato tramite open3d la situazione di partenza. Una volta aggiornate le bounding boxes, vengono analizzate le eventuali restanti point clouds che non erano presenti all'interno di queste ultime e ne vengono create nuove. Se delle bounding box si sovrappongono, vengono rimosse quelle più piccole. Se viene utilizzato il primo metodo di espansione delle bonding boxes, vengono prima mostrate le bounding boxes espanse e successivamente quelle aggiornate. Nel caso, invece, della clusterizzazione dei punti vicini, venogno mostrate le bounding box finali con i nouvi punti aggiunti di colore verde.
	\item findPointsOutsideBB: rappresenta la funzione che trova i punti esterni alle bounding boxes.
	\item removeOverlappingBoxes: rimuove le bounding boxes che si sovrappongono.
	\item displayBoundingBoxes: mostra le bounding boxes e le point clouds tramite open3d.
\end{itemize}
\subsection{main}
Il file main.py è il file principale del progetto, il quale inizializza le prime bounding box utilizzando metodi presenti nella repository blensor\_analysis implementati in blensoranalysis. Quest'ultima funge da tramite tra DynamicBBox e blensor\_analysis.\\
Tramite ciclo for vengono aggiornate le bounding boxes in base agli scan successivi.
\subsection{point}
\end{document}
